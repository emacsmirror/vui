#+title: Changelog
#+author: Boris Buliga

All notable changes to this project will be documented in this file.

The format is based on [[https://keepachangelog.com/en/1.1.0/][Keep a Changelog]], and this project adheres to [[https://semver.org/spec/v2.0.0.html][Semantic Versioning]].

* Unreleased

** Breaking Changes

- *vui-field validation removed*: Validation support has been removed from =vui-field= to keep primitives simple and stateless. Use =vui-typed-field= from =vui-components.el= for validation. Removed:
  - Props: =:valid-regexp=, =:valid-p=, =:error-face=, =:error-message=
  - Functions: =vui-field-valid-p=, =vui-fields-validate=, =vui-field-touch=, =vui-field-reset=
  - Face: =vui-field-error=

** Fixed

- Disabled buttons now use =widget-inactive= face instead of the regular button face.

** Added

- *vui-typed-field component*: New component in =vui-components.el= for typed input with parsing and validation. Uses component state to preserve raw input (e.g., users can see "123f" they typed while error is displayed).
  - Supported types: =integer=, =natnum=, =float=, =number=, =file=, =directory=, =symbol=, =sexp=
  - =:on-change= and =:on-submit= receive typed values only when input is valid
  - =:on-error= callback receives =(error-msg raw-input)= on invalid input
  - Numeric constraints via =:min= and =:max=
  - Custom validation via =:validate= (receives typed value)
  - Error display via =:show-error= (=t= or ='below= for below field, ='inline= for same line)
  - =:required= constraint for non-empty validation
- *Typed field shortcuts* in =vui-components.el= (wrappers around =vui-typed-field=):
  - =vui-integer-field=, =vui-natnum-field=, =vui-float-field=, =vui-number-field= for numeric input
  - =vui-file-field=, =vui-directory-field= for path input
  - =vui-symbol-field=, =vui-sexp-field= for Lisp input

** Changed

- *vui-components.el*: New component library with higher-level components built on vui primitives.
- =vui-collapsible=: Togglable section that expands/collapses content. Supports both uncontrolled (manages own state) and controlled (=:expanded= prop) modes. Features customizable indicators, title face, indentation, and proper nested indentation via context propagation.
- *Semantic text components*: Thin wrappers around =vui-text= with customizable faces that inherit from standard Emacs faces:
  - =vui-heading= with =:level= (1-8) and =vui-heading-1= through =vui-heading-8= (inherit from =outline-1= through =outline-8=)
  - =vui-strong= (inherit from =bold=), =vui-italic= (inherit from =italic=)
  - =vui-muted= (inherit from =shadow=), =vui-code= (inherit from =fixed-pitch=)
  - =vui-error= (inherit from =error=), =vui-warning= (inherit from =warning=), =vui-success= (inherit from =success=)

** Fixed

- *Keymap hierarchy*: =special-mode-map= bindings (like =h= for help) were inaccessible because =set-keymap-parent= overwrote the parent set by =define-derived-mode=. Now uses =make-composed-keymap= to include both =widget-keymap= and =special-mode-map=.
- *Table cursor preservation*: Widgets inside table cells now have unique paths based on row and column indices. Previously, all widgets in a table shared the same render path, causing cursor restoration to potentially jump to the wrong widget (e.g., from row 2's field to row 1's field) after re-render.

** Added

- =vui-quit= command bound to =q=: Quits window when outside widget fields, self-inserts when inside (so you can type "q" in text inputs).
- =vui-refresh= command bound to =g=: Re-renders the UI with current state when outside widget fields, self-inserts when inside. Applications needing custom refresh logic (e.g., re-fetching data) can override in their derived mode.
- =vui-button= now accepts =:tab-order= and =:keymap= props. Use =:tab-order -1= to make a button non-tabbable, and =:keymap= to define custom key bindings active when point is on the button.
- =vui-field= now accepts =:face= and =:placeholder= props. Use =:face= to style the field text, and =:placeholder= for placeholder text when the field is empty.

* v1.0.0 - 2025-12-28

** Breaking Changes

- *Symbol Prefix Rename*: All public macros now use the =vui-= prefix to comply with MELPA naming conventions:
  - =defcomponent= → =vui-defcomponent=
  - =defcontext= → =vui-defcontext=
  - =use-effect= → =vui-use-effect=
  - =use-ref= → =vui-use-ref=
  - =use-callback= → =vui-use-callback=
  - =use-callback*= → =vui-use-callback*=
  - =use-memo= → =vui-use-memo=
  - =use-memo*= → =vui-use-memo*=
  - =use-async= → =vui-use-async=

  See the README section "Using Shorter Names (Shorthands)" for how to use aliases or =read-symbol-shorthands= if you prefer the shorter names.

* v1.0.0-rc.3 - 2025-12-20

** Added

- =vui-mode= major mode for VUI buffers. Provides =vui-mode-map= that users and packages can extend (e.g., for =ace-link=). Packages using VUI can derive their own modes from =vui-mode= to add custom keybindings while preserving VUI and widget functionality.
- Documentation of Emacs 29 single-widget TAB navigation limitation (upstream [[https://debbugs.gnu.org/cgi/bugreport.cgi?bug=70594][bug#70594]], fixed in Emacs 30).

** Fixed

- =vui-table= now respects =:indent= from parent =vui-vstack=. Previously, only the first line of a table was indented; now all lines are properly indented.
- Cursor preservation now uses path-based widget tracking instead of index-based. Cursor correctly follows widgets when other widgets are added or removed before them. Previously, adding a widget above the cursor position would cause the cursor to land on the wrong widget after re-render.

** Changed

- =vui-mount= and =vui-render= now enable =vui-mode= instead of using =kill-all-local-variables=. This preserves derived modes and their keybindings across re-renders.

* v1.0.0-rc.2 - 2025-12-12

** Changed

- =vui-list= now returns =vstack= (for vertical, default) or =hstack= (for horizontal) instead of a fragment. This ensures proper indent propagation when nested inside layout containers.

** Added

- =:indent= and =:spacing= options for =vui-list=.
- Optional docstring support in =vui-defcomponent= macro.
- =:no-decoration= option for =vui-button= to render without brackets.
- =:help-echo= option for =vui-button= to control tooltip. Setting to =nil= disables tooltip generation, providing ~2x faster button creation for bulk rendering.

** Fixed

- Propagate indent through =hstack= to nested =vstack=. When a =vstack= was nested inside an =hstack=, the indent context from parent =vstacks= was lost, causing subsequent lines to render without proper indentation.
- Accumulate indent correctly in nested =vstacks=.
- Components that render to =nil= no longer affect =vstack= / =hstack= spacing. Previously, a component returning =nil= (e.g., =(when condition (vui-text "..."))=) would still cause separator newlines/spaces to be inserted, resulting in extra blank lines or spaces in the output.

* v1.0.0-rc.1 - 2025-12-03

Initial release candidate.

** Added

- Core rendering engine with virtual DOM diffing and reconciliation.
- Component system with =vui-defcomponent= macro.
- Hooks: =vui-use-effect=, =vui-use-memo=, =vui-use-ref=, =vui-use-async=.
- Layout primitives: =vui-vstack=, =vui-hstack=, =vui-box=, =vui-table=.
- Basic elements: =vui-text=, =vui-button=, =vui-link=, =vui-input=, =vui-checkbox=, =vui-select=.
- Utility components: =vui-fragment=, =vui-newline=, =vui-space=, =vui-list=, =vui-error-boundary=.
- Async utilities: =vui-async-callback=, =vui-with-async-context=.
- Debug mode with =vui-debug-mode=.
- Comprehensive documentation and examples.
